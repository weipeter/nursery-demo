<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊâòÂ¨∞‰∏≠ÂøÉÁÆ°ÁêÜÁ≥ªÁµ± - Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }


        .container {
            width: 100vw;
            height: 100vh;
            background: white;
            overflow: hidden;
        }

        .header {
            background: #E96546;
            color: white;
            padding: 30px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.8rem;
            opacity: 0.9;
            margin: 0;
        }

        .header-class-btn {
            background: transparent;
            border: 2px solid white;
            color: white;
            font-size: 1.8rem;
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .header-class-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Áè≠Á¥öÈÅ∏ÊìáModal */
        .class-select-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .class-select-content {
            background-color: white;
            margin: 10% auto;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        .class-select-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .class-select-header h2 {
            color: #333;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .class-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .class-item {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .class-item:hover {
            background: #E96546;
            color: white;
            border-color: #E96546;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 101, 70, 0.3);
        }

        .class-item.current {
            background: #E96546;
            color: white;
            border-color: #E96546;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .medication-summary {
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            margin-right: 10px;
        }

        .header-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            color: #333;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .header-btn-feeding {
            background: linear-gradient(135deg, #FFB6C1 0%, #FFC0CB 100%);
        }

        .header-btn-diaper {
            background: linear-gradient(135deg, #B0E0E6 0%, #87CEEB 100%);
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .students-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 20px;
            padding: 30px;
            height: calc(100vh - 120px);
        }

        .student-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            border: 3px solid transparent;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 0;
        }

        .medicine-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        .medicine-icon {
            width: 28px;
            height: 28px;
            margin-bottom: 4px;
        }

        .medicine-count {
            background: #E96546;
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 30px;
            text-align: center;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .student-card.present {
            border-color: #90EE90;
            background: linear-gradient(135deg, #F0FFF0 0%, #E6FFE6 100%);
        }

        .student-card.absent {
            position: relative;
        }

        .student-card.absent::after {
            content: 'Ë´ãÂÅá\A\A 2025/10/02-2025/10/03\A ÁôºÁáíÂí≥ÂóΩ';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 15px;
            white-space: pre-line;
            text-align: center;
            line-height: 1.4;
        }

        .student-card.absent.student3::after {
            content: 'Ë´ãÂÅá\A\A 2025/10/02-2025/10/03\A ÁôºÁáíÂí≥ÂóΩ';
        }

        .student-card.absent.student9::after {
            content: 'Ë´ãÂÅá\A\A 2025/10/02-2025/10/03\A ÂÆ∂Â∫≠ÊóÖÈÅä';
        }

        .student-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #e0e0e0;
            flex-shrink: 0;
        }

        .student-avatar:hover {
            transform: scale(1.1);
            border-color: #87CEEB;
        }

        .student-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            flex-shrink: 0;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-shrink: 0;
        }

        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
            min-height: 44px;
        }

        .btn-feeding {
            background: linear-gradient(135deg, #FFB6C1 0%, #FFC0CB 100%);
            color: #333;
        }

        .btn-diaper {
            background: linear-gradient(135deg, #B0E0E6 0%, #87CEEB 100%);
            color: #333;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            width: 95%;
            max-width: 1000px;
            height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 0;
            flex-shrink: 0;
        }

        .modal-top-section {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex: 1;
            min-height: 0;
        }

        .modal-student-info {
            display: flex;
            align-items: flex-start;
            flex: 1;
        }

        .modal-attendance-section {
            flex: 1;
        }

        .modal-medication-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .modal-action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-shrink: 0;
        }

        .modal-action-btn {
            flex: 1;
            background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 100%);
            color: #333;
            border: none;
            border-radius: 15px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .modal-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-action-btn.emergency {
            background: linear-gradient(135deg, #FFB6C1 0%, #FFC0CB 100%);
        }

        .modal-bottom-section {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 0;
        }

        .modal-feeding-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .modal-diaper-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .modal-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-right: 20px;
            border: 4px solid #87CEEB;
        }

        .modal-info h2 {
            color: #333;
            margin-bottom: 5px;
        }

        .modal-info p {
            color: #666;
            font-size: 1.1rem;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            margin-left: auto;
        }

        .close:hover {
            color: #000;
        }

        .timeline-section {
            margin-bottom: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            max-height: 100%;
        }

        .timeline-section h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .timeline-section h3 .title-text {
            display: flex;
            align-items: center;
        }

        .add-record-btn {
            background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 6px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-record-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }

        /* È§µÂ•∂Ë®àÁÆóÂô®Modal */
        .calculator-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .calculator-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        #diaperModal .calculator-content {
            max-width: 800px;
        }

        .calculator-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .calculator-header h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .calculator-display {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calculator-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .calc-btn {
            background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 100%);
            color: #333;
            border: none;
            border-radius: 10px;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .calc-btn.clear {
            background: #B8B8B8;
            color: #333;
        }

        .calc-btn.complete {
            background: #E96546;
            grid-column: span 3;
            font-size: 1.1rem;
            width: 100%;
            color: white;
        }

        .stool-btn {
            transition: all 0.3s ease;
            border: none;
        }

        .stool-btn.selected {
            background: #E96546 !important;
            color: white !important;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(233, 101, 70, 0.4);
        }

        .timeline-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .feeding .timeline-icon {
            background: linear-gradient(135deg, #FFB6C1 0%, #FFC0CB 100%);
        }

        .diaper .timeline-icon {
            background: linear-gradient(135deg, #B0E0E6 0%, #87CEEB 100%);
        }

        .attendance .timeline-icon {
            background: linear-gradient(135deg, #90EE90 0%, #98FB98 100%);
        }

        .medication .timeline-icon {
            background: linear-gradient(135deg, #FFA500 0%, #FFD700 100%);
        }

        .timeline-item {
            background: #F8F8FF;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #87CEEB;
        }

        .timeline-item.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeline-item.clickable:hover {
            background: #E6E6FA;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .timeline-content {
            overflow-y: auto;
            flex: 1;
            min-height: 0;
        }

        .attendance {
            flex: 0 0 auto;
        }

        .timeline-item .time {
            font-weight: bold;
            color: #87CEEB;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .timeline-item .time span {
            color: #666;
        }

        .timeline-item .delete-btn {
            color: #999;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
            transition: color 0.3s ease;
        }

        .timeline-item .delete-btn:hover {
            color: #ff4444;
        }

        .timeline-item .description {
            color: #666;
        }

        .medication-item {
            padding: 15px;
        }

        .medication-time {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .medication-content {
            color: #666;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .medication-completed {
            color: #7AD0B2;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .medication-completed.pending {
            color: #B8B8B8;
            font-weight: normal;
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .students-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .header h1 {
                font-size: 2rem;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                padding: 20px;
            }

            .header-actions {
                width: 100%;
                justify-content: center;
            }

            .header-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .students-grid {
                grid-template-columns: 1fr;
            }

            .header p {
                font-size: 1.4rem;
            }

            .header-actions {
                flex-direction: column;
                width: 100%;
            }

            .header-btn {
                width: 100%;
                padding: 12px 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <button class="header-class-btn" onclick="openClassSelectModal()">Elephant Â§ßË±°Áè≠</button>
            <div class="header-actions">
                <span class="medication-summary" id="medicationSummary">‰ªäÊó•È§µËó•Ôºö2/3</span>
                <button class="header-btn header-btn-feeding" onclick="recordAllFeeding()">ÂÖ®Áè≠È§µÂ•∂</button>
                <button class="header-btn header-btn-diaper" onclick="recordAllDiaper()">ÂÖ®Áè≠ÊèõÂ∞øÂ∏É</button>
            </div>
        </div>

        <div class="students-grid">
            <!-- Á¨¨‰∏ÄË°åÂ≠∏Áîü -->
            <div class="student-card present" onclick="openModal('student1')">
                <div class="medicine-badge">
                    <img src="./medicine.png" alt="È§µËó•" class="medicine-icon">
                    <div class="medicine-count">2/3</div>
                </div>
                <img src="./1.jpg" alt="Â∞èÁæé" class="student-avatar">
                <div class="student-name">Â∞èÁæé</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student1')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student1')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>

            <div class="student-card" onclick="openModal('student2')">
                <img src="./2.jpg" alt="Â∞èÈõÖ" class="student-avatar">
                <div class="student-name">Â∞èÈõÖ</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student2')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student2')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>

            <div class="student-card absent student3" onclick="openModal('student3')">
                <img src="./3.jpg" alt="Â∞èËèØ" class="student-avatar">
                <div class="student-name">Â∞èËèØ</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student3')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student3')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>

            <div class="student-card" onclick="openModal('student4')">
                <img src="./4.jpg" alt="Â∞èÂº∑" class="student-avatar">
                <div class="student-name">Â∞èÂº∑</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student4')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student4')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>

            <div class="student-card" onclick="openModal('student5')">
                <img src="./5.jpg" alt="Â∞èÊ•ì" class="student-avatar">
                <div class="student-name">Â∞èÊ•ì</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student5')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student5')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>

            <!-- Á¨¨‰∫åË°åÂ≠∏Áîü -->
            <div class="student-card" onclick="openModal('student6')">
                <img src="./6.jpg" alt="Â∞èÈ∫ó" class="student-avatar">
                <div class="student-name">Â∞èÈ∫ó</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student6')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student6')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>

            <div class="student-card" onclick="openModal('student7')">
                <img src="./7.jpg" alt="Â∞èÈùí" class="student-avatar">
                <div class="student-name">Â∞èÈùí</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student7')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student7')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>

            <div class="student-card" onclick="openModal('student8')">
                <img src="./8.jpg" alt="Â∞èÂºµ" class="student-avatar">
                <div class="student-name">Â∞èÂºµ</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student8')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student8')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>

            <div class="student-card absent student9" onclick="openModal('student9')">
                <img src="./9.jpg" alt="Â∞èÂÆá" class="student-avatar">
                <div class="student-name">Â∞èÂÆá</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student9')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student9')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>

            <div class="student-card" onclick="openModal('student10')">
                <img src="./10.jpg" alt="Â∞è‰ø°" class="student-avatar">
                <div class="student-name">Â∞è‰ø°</div>
                <div class="action-buttons">
                    <button class="btn btn-feeding"
                        onclick="event.stopPropagation(); recordFeeding('student10')">È§µÂ•∂</button>
                    <button class="btn btn-diaper"
                        onclick="event.stopPropagation(); recordDiaper('student10')">ÊèõÂ∞øÂ∏É</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Áè≠Á¥öÈÅ∏ÊìáModal -->
    <div id="classSelectModal" class="class-select-modal">
        <div class="class-select-content">
            <div class="class-select-header">
                <h2>ÈÅ∏ÊìáÁè≠Á¥ö</h2>
            </div>
            <div class="class-list">
                <div class="class-item current" onclick="selectClass('Elephant Â§ßË±°Áè≠')">Elephant Â§ßË±°Áè≠</div>
                <div class="class-item" onclick="selectClass('Panda ÁÜäË≤ìÁè≠')">Panda ÁÜäË≤ìÁè≠</div>
                <div class="class-item" onclick="selectClass('Rabbit ÂÖîÂ≠êÁè≠')">Rabbit ÂÖîÂ≠êÁè≠</div>
                <div class="class-item" onclick="selectClass('Lion ÁçÖÂ≠êÁè≠')">Lion ÁçÖÂ≠êÁè≠</div>
                <div class="class-item" onclick="selectClass('Tiger ËÄÅËôéÁè≠')">Tiger ËÄÅËôéÁè≠</div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
            </div>

            <div class="modal-top-section">
                <div class="modal-student-info">
                    <img id="modalAvatar" src="" alt="Â≠∏ÁîüÈ†≠ÂÉè" class="modal-avatar">
                    <div class="modal-info">
                        <h2 id="modalName"></h2>
                        <p id="modalStatus"></p>
                        <div class="modal-action-buttons">
                            <button class="modal-action-btn" onclick="openStudentProfile()">ÂÖ•ÊâòË≥áÊñô</button>
                            <button class="modal-action-btn emergency" onclick="openEmergencyRecord()">Áï∞Â∏∏ËøΩËπ§</button>
                        </div>
                    </div>
                </div>

                <div class="modal-medication-section">
                    <div class="timeline-section medication">
                        <h3><span class="title-text">
                                <div class="timeline-icon"></div>Ë®óËó•ÂñÆ <span id="medicationCount">(0/0)</span>
                            </span></h3>
                        <div class="timeline-content" id="medicationRecords">
                            <!-- Ë®óËó•Ë®òÈåÑÂ∞áÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-bottom-section">
                <div class="modal-feeding-section">
                    <div class="timeline-section feeding">
                        <h3><span class="title-text">
                                <div class="timeline-icon"></div>È§µÂ•∂Ë®òÈåÑ
                            </span><button class="add-record-btn" onclick="addFeedingRecord()">+ Êñ∞Â¢û</button></h3>
                        <div class="timeline-content" id="feedingRecords">
                            <!-- È§µÂ•∂Ë®òÈåÑÂ∞áÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                </div>

                <div class="modal-diaper-section">
                    <div class="timeline-section diaper">
                        <h3><span class="title-text">
                                <div class="timeline-icon"></div>ÊèõÂ∞øÂ∏ÉË®òÈåÑ
                            </span><button class="add-record-btn" onclick="addDiaperRecord()">+ Êñ∞Â¢û</button></h3>
                        <div class="timeline-content" id="diaperRecords">
                            <!-- ÊèõÂ∞øÂ∏ÉË®òÈåÑÂ∞áÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- È§µÂ•∂Ë®àÁÆóÂô®Modal -->
    <div id="calculatorModal" class="calculator-modal">
        <div class="calculator-content">
            <div class="calculator-header">
                <h3 id="calculatorTitle">È§µÂ•∂Ë®òÈåÑ</h3>
                <p id="calculatorStudent">Â≠∏ÁîüÂßìÂêç</p>
            </div>
            <div style="margin-bottom: 20px;">
                <label
                    style="display: block; margin-bottom: 10px; color: #333; font-weight: bold; text-align: center;">ÊôÇÈñìÔºö</label>
                <input type="time" id="feedingTimeInput"
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem; text-align: center;" />
            </div>
            <div class="calculator-display" id="calculatorDisplay">0</div>
            <div class="calculator-keypad">
                <button class="calc-btn" onclick="calculatorInput('1')">1</button>
                <button class="calc-btn" onclick="calculatorInput('2')">2</button>
                <button class="calc-btn" onclick="calculatorInput('3')">3</button>
                <button class="calc-btn" onclick="calculatorInput('4')">4</button>
                <button class="calc-btn" onclick="calculatorInput('5')">5</button>
                <button class="calc-btn" onclick="calculatorInput('6')">6</button>
                <button class="calc-btn" onclick="calculatorInput('7')">7</button>
                <button class="calc-btn" onclick="calculatorInput('8')">8</button>
                <button class="calc-btn" onclick="calculatorInput('9')">9</button>
                <button class="calc-btn clear" onclick="calculatorClear()">Ê∏ÖÈô§</button>
                <button class="calc-btn" onclick="calculatorInput('0')">0</button>
                <button class="calc-btn" onclick="calculatorBackspace()">‚Üê</button>
            </div>
            <button class="calc-btn complete" onclick="calculatorComplete()">ÂÆåÊàê</button>
        </div>
    </div>

    <!-- ÊèõÂ∞øÂ∏ÉË®òÈåÑModal -->
    <div id="diaperModal" class="calculator-modal">
        <div class="calculator-content">
            <div class="calculator-header">
                <h3 id="diaperModalTitle">ÊèõÂ∞øÂ∏ÉË®òÈåÑ</h3>
                <p id="diaperModalStudent">Â≠∏ÁîüÂßìÂêç</p>
            </div>
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <!-- Â∑¶ÂÅ¥ÔºöÊôÇÈñìÂíå‰æø‰æøÁãÄÊ≥Å -->
                <div style="flex: 1;">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; color: #333; font-weight: bold;">ÊôÇÈñìÔºö</label>
                        <input type="time" id="diaperTimeInput"
                            style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem; text-align: center;" />
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label
                            style="display: block; margin-bottom: 10px; color: #333; font-weight: bold;">‰æø‰æøÁãÄÊ≥ÅÔºö</label>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <button id="stoolBtn-Ê≠£Â∏∏" class="calc-btn stool-btn" onclick="selectStool('Ê≠£Â∏∏')"
                                style="background: #e3e2e2; color: #B8B8B8;">Ê≠£Â∏∏</button>
                            <button id="stoolBtn-ÂÅèËªü" class="calc-btn stool-btn" onclick="selectStool('ÂÅèËªü')"
                                style="background: #e3e2e2; color: #B8B8B8;">ÂÅèËªü</button>
                            <button id="stoolBtn-ÂÅèÁ°¨" class="calc-btn stool-btn" onclick="selectStool('ÂÅèÁ°¨')"
                                style="background: #e3e2e2; color: #B8B8B8;">ÂÅèÁ°¨</button>
                            <button id="stoolBtn-ÁÑ°" class="calc-btn stool-btn" onclick="selectStool('ÁÑ°')"
                                style="background: #e3e2e2; color: #B8B8B8;">ÁÑ°</button>
                        </div>
                    </div>
                </div>
                <!-- Âè≥ÂÅ¥ÔºöÁÖßÁâá -->
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 10px; color: #333; font-weight: bold;">ÁÖßÁâáÔºö</label>
                    <input type="file" id="diaperPhotoInput" accept="image/*" multiple style="display: none;"
                        onchange="handleDiaperPhotoUpload(event)" />
                    <button type="button" class="calc-btn" onclick="document.getElementById('diaperPhotoInput').click()"
                        style="width: 100%; background: #98CCF0; margin-bottom: 15px; color: white;">
                        üì∑ ‰∏äÂÇ≥ÁÖßÁâá
                    </button>
                    <div id="diaperPhotoPreview"
                        style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                        <!-- ÁÖßÁâáÂ∞áÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="calc-btn clear" onclick="closeDiaperModal()" style="flex: 1;">ÂèñÊ∂à</button>
                <button class="calc-btn complete" onclick="diaperRecordComplete()" style="flex: 1;">ÂÆåÊàê</button>
            </div>
        </div>
    </div>

    <script>
        // Â≠∏ÁîüË≥áÊñô
        const students = {
            'student1': {
                name: 'Â∞èÁæé',
                avatar: './1.jpg',
                status: 'Âú®Ê†°',
                feeding: [
                    { time: '08:30', description: '150ml' },
                    { time: '10:30', description: '80ml' },
                    { time: '12:00', description: '200ml' }
                ],
                diaper: [
                    { time: '09:15', description: '', stool: 'Ê≠£Â∏∏' },
                    { time: '11:30', description: '', stool: 'ÁÑ°' }
                ],
                attendance: [
                    { time: '08:00', description: 'Á∞ΩÂà∞ - Â™ΩÂ™ΩÈÄÅ‰æÜ' },
                    { time: '17:30', description: 'Á∞ΩÈÄÄ - Áà∏Áà∏Êé•Ëµ∞' }
                ],
                medication: [
                    {
                        medicationTime: 'Êó©‰∏äÈªûÂøÉÂæå',
                        medicationContent: 'Ëó•Ê∞¥ 5cc',
                        completedTime: '10:30'
                    },
                    {
                        medicationTime: 'ÂçàÈ§êÂæå',
                        medicationContent: 'Ëó•‰∏∏ 2È°Ü',
                        completedTime: ''
                    },
                    {
                        medicationTime: '‰∏ãÂçàÈªûÂøÉÂâç',
                        medicationContent: 'Ëó•Ê∞¥ 3cc',
                        completedTime: '15:00'
                    }
                ]
            },
            'student2': {
                name: 'Â∞èÈõÖ',
                avatar: './2.jpg',
                status: 'Âú®Ê†°',
                feeding: [
                    { time: '08:45', description: '180ml' },
                    { time: '11:00', description: '100ml' }
                ],
                diaper: [
                    { time: '09:30', description: 'Â∞øÂ∏ÉÊøï‰∫ÜÔºåÂ∑≤Êõ¥Êèõ', stool: 'Ê≠£Â∏∏' }
                ],
                attendance: [
                    { time: '08:15', description: 'Á∞ΩÂà∞ - Áà∏Áà∏ÈÄÅ‰æÜ' }
                ],
                medication: [
                    { time: '10:00', description: 'Êó©‰∏äÈªûÂøÉÂæå' },
                    { time: '14:30', description: '‰∏ãÂçàÈªûÂøÉÂâç' }
                ]
            },
            'student3': {
                name: 'Â∞èËèØ',
                avatar: './3.jpg',
                status: 'Ë´ãÂÅá',
                feeding: [],
                diaper: [],
                attendance: [],
                medication: []
            },
            'student4': {
                name: 'Â∞èÂº∑',
                avatar: './4.jpg',
                status: 'Âú®Ê†°',
                feeding: [
                    { time: '08:20', description: '160ml' },
                    { time: '10:00', description: '120ml' }
                ],
                diaper: [
                    { time: '09:00', description: '', stool: 'ÂÅèËªü' },
                    { time: '10:45', description: '', stool: 'Ê≠£Â∏∏' }
                ],
                attendance: [
                    { time: '07:45', description: 'Á∞ΩÂà∞ - Â™ΩÂ™ΩÈÄÅ‰æÜ' }
                ],
                medication: [
                    { time: '11:00', description: 'Êó©‰∏äÈªûÂøÉÂæå' },
                    { time: '13:00', description: 'ÂçàÈ§êÂæå' }
                ]
            },
            'student5': {
                name: 'Â∞èÊ•ì',
                avatar: './5.jpg',
                status: 'Âú®Ê†°',
                feeding: [
                    { time: '08:00', description: '200ml' }
                ],
                diaper: [
                    { time: '08:30', description: '', stool: 'Ê≠£Â∏∏' }
                ],
                attendance: [
                    { time: '07:30', description: 'Á∞ΩÂà∞ - Áà∏Áà∏ÈÄÅ‰æÜ' }
                ],
                medication: [
                    { time: '10:15', description: 'Êó©‰∏äÈªûÂøÉÂæå' },
                    { time: '15:30', description: '‰∏ãÂçàÈªûÂøÉÂâç' }
                ]
            },
            'student6': {
                name: 'Â∞èÈ∫ó',
                avatar: './6.jpg',
                status: 'Âú®Ê†°',
                feeding: [
                    { time: '08:15', description: '140ml' },
                    { time: '10:15', description: '100ml' }
                ],
                diaper: [
                    { time: '09:45', description: '', stool: 'Ê≠£Â∏∏' }
                ],
                attendance: [
                    { time: '08:00', description: 'Á∞ΩÂà∞ - Â™ΩÂ™ΩÈÄÅ‰æÜ' }
                ],
                medication: [
                    { time: '09:30', description: 'Êó©‰∏äÈªûÂøÉÂæå' },
                    { time: '12:15', description: 'ÂçàÈ§êÂæå' },
                    { time: '16:00', description: '‰∏ãÂçàÈªûÂøÉÂâç' }
                ]
            },
            'student7': {
                name: 'Â∞èÈùí',
                avatar: './7.jpg',
                status: 'Âú®Ê†°',
                feeding: [
                    { time: '08:30', description: '170ml' }
                ],
                diaper: [
                    { time: '09:15', description: '', stool: 'ÁÑ°' }
                ],
                attendance: [
                    { time: '08:10', description: 'Á∞ΩÂà∞ - Áà∏Áà∏ÈÄÅ‰æÜ' }
                ],
                medication: [
                    { time: '11:30', description: 'Êó©‰∏äÈªûÂøÉÂæå' }
                ]
            },
            'student8': {
                name: 'Â∞èÂºµ',
                avatar: './8.jpg',
                status: 'Âú®Ê†°',
                feeding: [
                    { time: '08:25', description: '155ml' },
                    { time: '10:30', description: '90ml' }
                ],
                diaper: [
                    { time: '09:30', description: '', stool: 'Ê≠£Â∏∏' }
                ],
                attendance: [
                    { time: '08:05', description: 'Á∞ΩÂà∞ - Â™ΩÂ™ΩÈÄÅ‰æÜ' }
                ],
                medication: [
                    { time: '10:45', description: 'Êó©‰∏äÈªûÂøÉÂæå' },
                    { time: '13:30', description: 'ÂçàÈ§êÂæå' },
                    { time: '15:45', description: '‰∏ãÂçàÈªûÂøÉÂâç' }
                ]
            },
            'student9': {
                name: 'Â∞èÂÆá',
                avatar: './9.jpg',
                status: 'Ë´ãÂÅá',
                feeding: [],
                diaper: [],
                attendance: []
            },
            'student10': {
                name: 'Â∞è‰ø°',
                avatar: './10.jpg',
                status: 'Âú®Ê†°',
                feeding: [
                    { time: '08:10', description: '165ml' }
                ],
                diaper: [
                    { time: '09:00', description: '', stool: 'ÂÅèÁ°¨' }
                ],
                attendance: [
                    { time: '07:50', description: 'Á∞ΩÂà∞ - Áà∏Áà∏ÈÄÅ‰æÜ' }
                ],
                medication: [
                    { time: '09:15', description: 'Êó©‰∏äÈªûÂøÉÂæå' },
                    { time: '14:00', description: '‰∏ãÂçàÈªûÂøÉÂâç' }
                ]
            }
        };

        function openModal(studentId) {
            const student = students[studentId];
            if (!student) return;

            document.getElementById('modalAvatar').src = student.avatar;
            document.getElementById('modalName').textContent = student.name;

            // Â∞áÁ∞ΩÂà∞Á∞ΩÈÄÄË≥áË®äÈ°ØÁ§∫Âú®ÁãÄÊÖã‰ΩçÁΩÆ
            let statusText = student.status;
            if (studentId === 'student1') {
                // Â∞èÁæéÈ°ØÁ§∫ÂÆåÊï¥Á∞ΩÂà∞Á∞ΩÈÄÄË≥áË®ä
                if (student.attendance && student.attendance.length > 0) {
                    const checkIn = student.attendance.find(record => record.description.includes('Á∞ΩÂà∞'));
                    const checkOut = student.attendance.find(record => record.description.includes('Á∞ΩÈÄÄ'));
                    if (checkIn) {
                        statusText += ` | Á∞ΩÂà∞ ${checkIn.time}`;
                    }
                    if (checkOut) {
                        statusText += ` | Á∞ΩÈÄÄ ${checkOut.time}`;
                    }
                }
            } else if (student.status === 'Âú®Ê†°') {
                // ÂÖ∂‰ªñÂú®Ê†°Â≠∏ÁîüÈ°ØÁ§∫Â∞öÊú™Âà∞Ê†°
                statusText += ' | Â∞öÊú™Âà∞Ê†°';
            }
            document.getElementById('modalStatus').textContent = statusText;

            // Êõ¥Êñ∞È§µÂ•∂Ë®òÈåÑ
            const feedingRecords = document.getElementById('feedingRecords');
            feedingRecords.innerHTML = '';
            if (student.feeding.length === 0) {
                feedingRecords.innerHTML = '<div class="timeline-item"><div class="description">‰ªäÊó•Â∞öÁÑ°È§µÂ•∂Ë®òÈåÑ</div></div>';
            } else {
                // ÊåâÁÖßÊôÇÈñìÊéíÂ∫èÔºàÊúÄÊó©ÁöÑÂú®ÊúÄ‰∏äÈù¢Ôºâ
                const sortedFeeding = [...student.feeding].sort((a, b) => {
                    const timeA = a.time || '00:00';
                    const timeB = b.time || '00:00';
                    return timeA.localeCompare(timeB); // ÂçáÂ∫èÊéíÂ∫è
                });

                sortedFeeding.forEach((record, sortedIndex) => {
                    // ÊâæÂà∞ÂéüÂßãÁ¥¢Âºï‰ª•Ê≠£Á¢∫Âà™Èô§
                    const originalIndex = student.feeding.indexOf(record);
                    const item = document.createElement('div');
                    item.className = 'timeline-item';
                    item.innerHTML = `
                        <div class="time">${record.time}<span>${record.description}</span><span class="delete-btn" onclick="deleteFeedingRecord('${studentId}', ${originalIndex})">&times;</span></div>
                    `;
                    feedingRecords.appendChild(item);
                });
            }

            // Êõ¥Êñ∞ÊèõÂ∞øÂ∏ÉË®òÈåÑ
            const diaperRecords = document.getElementById('diaperRecords');
            diaperRecords.innerHTML = '';
            if (student.diaper.length === 0) {
                diaperRecords.innerHTML = '<div class="timeline-item"><div class="description">‰ªäÊó•Â∞öÁÑ°ÊèõÂ∞øÂ∏ÉË®òÈåÑ</div></div>';
            } else {
                // ÊåâÁÖßÊôÇÈñìÊéíÂ∫èÔºàÊúÄÊó©ÁöÑÂú®ÊúÄ‰∏äÈù¢Ôºâ
                const sortedDiaper = [...student.diaper].sort((a, b) => {
                    const timeA = a.time || '00:00';
                    const timeB = b.time || '00:00';
                    return timeA.localeCompare(timeB); // ÂçáÂ∫èÊéíÂ∫è
                });

                sortedDiaper.forEach((record, sortedIndex) => {
                    // ÊâæÂà∞ÂéüÂßãÁ¥¢Âºï‰ª•Ê≠£Á¢∫Á∑®ËºØÂíåÂà™Èô§
                    const originalIndex = student.diaper.indexOf(record);
                    const item = document.createElement('div');
                    item.className = 'timeline-item clickable';
                    const stoolStatus = record.stool || 'ÁÑ°';
                    item.onclick = function (event) {
                        // Â¶ÇÊûúÈªûÊìäÁöÑÊòØÂà™Èô§ÊåâÈàïÊàñÁÖßÁâáÔºå‰∏çËß∏ÁôºÁ∑®ËºØ
                        if (event.target.classList.contains('delete-btn') || event.target.tagName === 'IMG') {
                            return;
                        }
                        editDiaperRecord(studentId, originalIndex);
                    };
                    let photoHtml = '';
                    // ÊîØÊè¥Â§öÂºµÁÖßÁâáÊàñÂñÆÂºµÁÖßÁâá
                    const photos = record.photos && Array.isArray(record.photos) ? record.photos : (record.photo ? [record.photo] : []);
                    if (photos.length > 0) {
                        photoHtml = `<div style="margin-top: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">`;
                        photos.forEach((photo, photoIndex) => {
                            photoHtml += `<div style="aspect-ratio: 1; overflow: hidden; border-radius: 8px; border: 2px solid #e0e0e0;"><img src="${photo}" alt="ÁÖßÁâá" style="width: 100%; height: 100%; object-fit: cover; cursor: pointer;" onclick="event.stopPropagation(); window.open('${photo}', '_blank');" /></div>`;
                        });
                        photoHtml += `</div>`;
                    }
                    item.innerHTML = `
                        <div class="time">${record.time}<span class="delete-btn" onclick="event.stopPropagation(); deleteDiaperRecord('${studentId}', ${originalIndex})">&times;</span></div>
                        <div class="description">‰æø‰æøÁãÄÊ≥ÅÔºö${stoolStatus}</div>
                        ${photoHtml}
                    `;
                    diaperRecords.appendChild(item);
                });
            }


            // Êõ¥Êñ∞Ë®óËó•Ë®òÈåÑ
            const medicationRecords = document.getElementById('medicationRecords');
            medicationRecords.innerHTML = '';

            // Ë®àÁÆóÂ∑≤ÂÆåÊàêÂíåÁ∏ΩÊï∏
            let completedCount = 0;
            let totalCount = 0;

            if (student.medication && student.medication.length === 0) {
                medicationRecords.innerHTML = '<div class="timeline-item"><div class="description">‰ªäÊó•ÁÑ°Ë®óËó•</div></div>';
            } else if (student.medication) {
                totalCount = student.medication.length;

                // ÊåâÁÖßÊôÇÈñìÊéíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÊúÄ‰∏äÈù¢Ôºâ
                // ÂÑ™ÂÖà‰ΩøÁî® completedTimeÔºåÂ¶ÇÊûúÊ≤íÊúâÂâá‰ΩøÁî® medicationTime
                const sortedMedication = [...student.medication].sort((a, b) => {
                    // ËôïÁêÜËàäÊ†ºÂºèÔºàÂÖºÂÆπÔºâ
                    let timeA = a.completedTime || a.time || a.medicationTime || a.description || '00:00';
                    let timeB = b.completedTime || b.time || b.medicationTime || b.description || '00:00';

                    // Â¶ÇÊûúÊôÇÈñìÊ†ºÂºè‰∏çÊòØ HH:MMÔºåÂòóË©¶ÊèêÂèñÊôÇÈñìÈÉ®ÂàÜ
                    if (timeA.length > 5) {
                        const matchA = timeA.match(/(\d{1,2}):(\d{2})/);
                        if (matchA) timeA = `${matchA[1].padStart(2, '0')}:${matchA[2]}`;
                    }
                    if (timeB.length > 5) {
                        const matchB = timeB.match(/(\d{1,2}):(\d{2})/);
                        if (matchB) timeB = `${matchB[1].padStart(2, '0')}:${matchB[2]}`;
                    }

                    return timeB.localeCompare(timeA); // ÈôçÂ∫èÊéíÂ∫è
                });

                sortedMedication.forEach(record => {
                    const item = document.createElement('div');

                    // ËôïÁêÜËàäÊ†ºÂºèÔºàÂÖºÂÆπÔºâ
                    let medicationTime = record.medicationTime || record.description || '';
                    let medicationContent = record.medicationContent || '';
                    let completedTime = record.completedTime || record.time || '';

                    // Â¶ÇÊûúÊ≤íÊúâÊñ∞Ê†ºÂºèÔºå‰ΩøÁî®ËàäÊ†ºÂºè
                    if (!record.medicationTime && record.description) {
                        medicationTime = record.description;
                        medicationContent = '';
                        completedTime = record.time || '';
                    }

                    // Ë®àÁÆóÂ∑≤ÂÆåÊàêÊï∏Èáè
                    const isCompleted = completedTime && completedTime.trim() !== '';
                    if (isCompleted) {
                        completedCount++;
                    }

                    // Ê†πÊìöÂÆåÊàêÁãÄÊÖãË®≠ÁΩÆÊ®£Âºè
                    item.className = 'timeline-item medication-item';
                    if (isCompleted) {
                        item.style.borderLeftColor = '#7AD0B2'; // Á∂†Ëâ≤
                    } else {
                        item.style.borderLeftColor = '#B8B8B8'; // ÁÅ∞Ëâ≤
                    }

                    const completedTimeHtml = completedTime
                        ? `<div class="medication-completed">ÂÆåÊàêÊôÇÈñìÔºö${completedTime}</div>`
                        : `<div class="medication-completed pending">Â∞öÊú™ËôïÁêÜ</div>`;

                    item.innerHTML = `
                        <div class="medication-time">ÊúçËó•ÊôÇÈñìÔºö${medicationTime}</div>
                        ${medicationContent ? `<div class="medication-content">ÊúçËó•ÂÖßÂÆπÔºö${medicationContent}</div>` : ''}
                        ${completedTimeHtml}
                    `;
                    medicationRecords.appendChild(item);
                });
            } else {
                medicationRecords.innerHTML = '<div class="timeline-item"><div class="description">‰ªäÊó•ÁÑ°Ë®óËó•</div></div>';
            }

            // Êõ¥Êñ∞Ê®ôÈ°åÈ°ØÁ§∫Â∑≤ÂÆåÊàêÊ¨°Êï∏
            const medicationCountElement = document.getElementById('medicationCount');
            if (medicationCountElement) {
                medicationCountElement.textContent = `(${completedCount}/${totalCount})`;
            }

            document.getElementById('studentModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('studentModal').style.display = 'none';
        }

        function recordFeeding(studentId) {
            openCalculator(studentId);
        }

        let currentStudentId = '';
        let calculatorValue = '0';
        let isAllStudentsMode = false; // Ê®ôË®òÊòØÂê¶ÁÇ∫ÂÖ®Áè≠Ê®°Âºè

        function openCalculator(studentId) {
            currentStudentId = studentId;
            isAllStudentsMode = false;
            calculatorValue = '0';
            document.getElementById('calculatorStudent').textContent = students[studentId].name;
            document.getElementById('calculatorTitle').textContent = 'È§µÂ•∂Ë®òÈåÑ';
            document.getElementById('calculatorDisplay').textContent = calculatorValue + 'ml';

            // Ë®≠ÂÆöÈ†êË®≠ÊôÇÈñìÁÇ∫Áï∂ÂâçÊôÇÈñì
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('feedingTimeInput').value = `${hours}:${minutes}`;

            document.getElementById('calculatorModal').style.display = 'block';
        }

        function openCalculatorForAllStudents() {
            currentStudentId = '';
            isAllStudentsMode = true;
            calculatorValue = '0';
            // ÂÉÖÁ§∫ÊÑèÔºåÈ°ØÁ§∫Âõ∫ÂÆöÂ≠∏ÁîüÊï∏Èáè
            document.getElementById('calculatorStudent').textContent = 'ÂÖ®Áè≠È§µÂ•∂ (8 ‰ΩçÂ≠∏Áîü)';
            document.getElementById('calculatorTitle').textContent = 'ÂÖ®Áè≠È§µÂ•∂Ë®òÈåÑ';
            document.getElementById('calculatorDisplay').textContent = calculatorValue + 'ml';

            // Ë®≠ÂÆöÈ†êË®≠ÊôÇÈñìÁÇ∫Áï∂ÂâçÊôÇÈñì
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('feedingTimeInput').value = `${hours}:${minutes}`;

            document.getElementById('calculatorModal').style.display = 'block';
        }

        function calculatorInput(digit) {
            if (calculatorValue === '0') {
                calculatorValue = digit;
            } else {
                calculatorValue += digit;
            }
            document.getElementById('calculatorDisplay').textContent = calculatorValue + 'ml';
        }

        function calculatorClear() {
            calculatorValue = '0';
            document.getElementById('calculatorDisplay').textContent = calculatorValue + 'ml';
        }

        function calculatorBackspace() {
            if (calculatorValue.length > 1) {
                calculatorValue = calculatorValue.slice(0, -1);
            } else {
                calculatorValue = '0';
            }
            document.getElementById('calculatorDisplay').textContent = calculatorValue + 'ml';
        }

        function calculatorComplete() {
            const amount = calculatorValue + 'ml';
            // ÂæûÊôÇÈñìËº∏ÂÖ•Ê¨Ñ‰ΩçÂèñÂæóÊôÇÈñìÔºåÊ†ºÂºèËΩâÊèõÁÇ∫ HH:MM
            const timeInput = document.getElementById('feedingTimeInput').value;
            let time = '';
            if (timeInput) {
                const [hours, minutes] = timeInput.split(':');
                time = `${hours}:${minutes}`;
            } else {
                // Â¶ÇÊûúÊ≤íÊúâËº∏ÂÖ•ÊôÇÈñìÔºå‰ΩøÁî®Áï∂ÂâçÊôÇÈñì
                time = new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            }

            if (isAllStudentsMode) {
                // ÂÖ®Áè≠Ê®°ÂºèÔºöÂÉÖÁ§∫ÊÑè‰ªãÈù¢
                // ÈóúÈñâË®àÁÆóÂô®
                document.getElementById('calculatorModal').style.display = 'none';

                // È°ØÁ§∫Á§∫ÊÑèË®äÊÅØ
                alert(`ÂÖ®Áè≠È§µÂ•∂Ë®òÈåÑÔºàÁ§∫ÊÑèÔºâÔºö${amount}ÔºåÊôÇÈñìÔºö${time}`);
            } else {
                // ÂÄã‰∫∫Ê®°ÂºèÔºöÁÇ∫ÂñÆ‰∏ÄÂ≠∏ÁîüË®òÈåÑ
                students[currentStudentId].feeding.push({
                    time: time,
                    description: amount
                });

                // ÈóúÈñâË®àÁÆóÂô®
                document.getElementById('calculatorModal').style.display = 'none';

                // ÈáçÊñ∞ËºâÂÖ•modalÈ°ØÁ§∫Êõ¥Êñ∞ÂæåÁöÑË®òÈåÑÔºàÂ¶ÇÊûúmodalÊòØÊâìÈñãÁöÑÔºâ
                const studentModal = document.getElementById('studentModal');
                if (studentModal.style.display === 'block') {
                    openModal(currentStudentId);
                } else {
                    // Â¶ÇÊûúmodalÊ≤íÊúâÊâìÈñãÔºåÂè™È°ØÁ§∫ÊàêÂäüË®äÊÅØ
                    alert(`Â∑≤Ë®òÈåÑ ${students[currentStudentId].name} ÁöÑÈ§µÂ•∂Ôºö${amount}ÔºåÊôÇÈñìÔºö${time}`);
                }
            }
        }

        function closeCalculator() {
            document.getElementById('calculatorModal').style.display = 'none';
        }

        function openStudentProfile() {
            const studentName = document.getElementById('modalName').textContent;
            alert(`ÈñãÂïü ${studentName} ÁöÑÂÖ•ÊâòË≥áÊñô\n\nÂåÖÂê´Ôºö\n- Âü∫Êú¨Ë≥áÊñô\n- Á∑äÊÄ•ËÅØÁµ°‰∫∫\n- ÂÅ•Â∫∑ÁãÄÊ≥Å\n- ÁâπÊÆäÈúÄÊ±Ç\n- ÂÆ∂Èï∑ÊéàÊ¨äÊõ∏`);
        }

        function openEmergencyRecord() {
            const studentName = document.getElementById('modalName').textContent;
            alert(`ÈñãÂïü ${studentName} ÁöÑÁï∞Â∏∏Á¥ÄÈåÑËøΩËπ§\n\nÂåÖÂê´Ôºö\n- ÊÑèÂ§ñ‰∫ã‰ª∂Ë®òÈåÑ\n- ÂÅ•Â∫∑Áï∞Â∏∏ËøΩËπ§\n- Ë°åÁÇ∫ËßÄÂØüË®òÈåÑ\n- ËôïÁêÜÊé™ÊñΩ\n- ÂæåÁ∫åËøΩËπ§ÁãÄÊ≥Å`);
        }

        function recordDiaper(studentId) {
            alert(`Ë®òÈåÑ ${students[studentId].name} ÁöÑÊèõÂ∞øÂ∏ÉÊôÇÈñìÔºö${new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' })}`);
        }

        function deleteFeedingRecord(studentId, index) {
            if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜÈ§µÂ•∂Ë®òÈåÑÂóéÔºü')) {
                students[studentId].feeding.splice(index, 1);
                openModal(studentId); // ÈáçÊñ∞ËºâÂÖ•modalÈ°ØÁ§∫Êõ¥Êñ∞ÂæåÁöÑË®òÈåÑ
            }
        }

        function deleteDiaperRecord(studentId, index) {
            if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜÊèõÂ∞øÂ∏ÉË®òÈåÑÂóéÔºü')) {
                students[studentId].diaper.splice(index, 1);
                openModal(studentId); // ÈáçÊñ∞ËºâÂÖ•modalÈ°ØÁ§∫Êõ¥Êñ∞ÂæåÁöÑË®òÈåÑ
            }
        }

        function addFeedingRecord() {
            // ÊâæÂà∞Áï∂Ââçmodal‰∏≠È°ØÁ§∫ÁöÑÂ≠∏ÁîüID
            const modalName = document.getElementById('modalName').textContent;
            const studentId = Object.keys(students).find(id => students[id].name === modalName);

            if (studentId) {
                // ÊâìÈñãË®àÁÆóÊ©ü‰ªãÈù¢ËÆìÁî®Êà∂Ëº∏ÂÖ•ÊØ´ÂçáÊï∏
                openCalculator(studentId);
            }
        }

        let currentDiaperStudentId = '';
        let selectedStoolValue = '';
        let isAllDiaperMode = false; // Ê®ôË®òÊòØÂê¶ÁÇ∫ÂÖ®Áè≠Ê®°Âºè
        let editingDiaperIndex = -1; // Á∑®ËºØÊ®°ÂºèÊôÇÁöÑË®òÈåÑÁ¥¢ÂºïÔºå-1 Ë°®Á§∫Êñ∞Â¢ûÊ®°Âºè
        let diaperPhotos = []; // ÂÑ≤Â≠òÁï∂ÂâçÁ∑®ËºØÁöÑÁÖßÁâáÈô£Âàó

        function addDiaperRecord() {
            // ÊâæÂà∞Áï∂Ââçmodal‰∏≠È°ØÁ§∫ÁöÑÂ≠∏ÁîüID
            const modalName = document.getElementById('modalName').textContent;
            const studentId = Object.keys(students).find(id => students[id].name === modalName);

            if (studentId) {
                currentDiaperStudentId = studentId;
                isAllDiaperMode = false;
                editingDiaperIndex = -1; // Êñ∞Â¢ûÊ®°Âºè
                selectedStoolValue = '';
                document.getElementById('diaperModalTitle').textContent = 'ÊèõÂ∞øÂ∏ÉË®òÈåÑ';
                document.getElementById('diaperModalStudent').textContent = students[studentId].name;

                // Ê∏ÖÈô§ÊâÄÊúâÊåâÈàïÁöÑÈÅ∏‰∏≠ÁãÄÊÖã
                const allStoolBtns = document.querySelectorAll('.stool-btn');
                allStoolBtns.forEach(btn => {
                    btn.classList.remove('selected');
                });

                // Ë®≠ÂÆöÈ†êË®≠ÊôÇÈñìÁÇ∫ÁèæÂú®ÊôÇÈñì
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                document.getElementById('diaperTimeInput').value = `${hours}:${minutes}`;

                // Ê∏ÖÈô§ÁÖßÁâá
                diaperPhotos = [];
                updateDiaperPhotoPreview();

                document.getElementById('diaperModal').style.display = 'block';
            }
        }

        function editDiaperRecord(studentId, index) {
            const record = students[studentId].diaper[index];
            if (!record) return;

            currentDiaperStudentId = studentId;
            isAllDiaperMode = false;
            editingDiaperIndex = index; // Á∑®ËºØÊ®°Âºè
            selectedStoolValue = record.stool || 'ÁÑ°';

            document.getElementById('diaperModalTitle').textContent = 'Á∑®ËºØÊèõÂ∞øÂ∏ÉË®òÈåÑ';
            document.getElementById('diaperModalStudent').textContent = students[studentId].name;

            // ÁßªÈô§ÊâÄÊúâÊåâÈàïÁöÑÈÅ∏‰∏≠ÁãÄÊÖã
            const allStoolBtns = document.querySelectorAll('.stool-btn');
            allStoolBtns.forEach(btn => {
                btn.classList.remove('selected');
            });

            // Ë®≠ÁΩÆÂ∞çÊáâÊåâÈàïÁÇ∫ÈÅ∏‰∏≠ÁãÄÊÖã
            const selectedBtn = document.getElementById(`stoolBtn-${selectedStoolValue}`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
            }

            // Ë®≠ÂÆöÊôÇÈñìÁÇ∫Ë®òÈåÑ‰∏≠ÁöÑÊôÇÈñì
            const [hours, minutes] = record.time.split(':');
            document.getElementById('diaperTimeInput').value = `${hours}:${minutes}`;

            // Â¶ÇÊûúÊúâÁÖßÁâáÔºåÈ°ØÁ§∫È†êË¶Ω
            if (record.photos && Array.isArray(record.photos) && record.photos.length > 0) {
                diaperPhotos = [...record.photos];
            } else if (record.photo) {
                // ÂÖºÂÆπËàäÁöÑÂñÆÂºµÁÖßÁâáÊ†ºÂºè
                diaperPhotos = [record.photo];
            } else {
                diaperPhotos = [];
            }
            updateDiaperPhotoPreview();

            document.getElementById('diaperModal').style.display = 'block';
        }

        function openDiaperModalForAllStudents() {
            currentDiaperStudentId = '';
            isAllDiaperMode = true;
            selectedStoolValue = '';
            document.getElementById('diaperModalTitle').textContent = 'ÂÖ®Áè≠ÊèõÂ∞øÂ∏ÉË®òÈåÑ';
            document.getElementById('diaperModalStudent').textContent = 'ÂÖ®Áè≠ÊèõÂ∞øÂ∏É (8 ‰ΩçÂ≠∏Áîü)';

            // Ê∏ÖÈô§ÊâÄÊúâÊåâÈàïÁöÑÈÅ∏‰∏≠ÁãÄÊÖã
            const allStoolBtns = document.querySelectorAll('.stool-btn');
            allStoolBtns.forEach(btn => {
                btn.classList.remove('selected');
            });

            // Ë®≠ÂÆöÈ†êË®≠ÊôÇÈñìÁÇ∫ÁèæÂú®ÊôÇÈñì
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('diaperTimeInput').value = `${hours}:${minutes}`;

            // Ê∏ÖÈô§ÁÖßÁâá
            diaperPhotos = [];
            updateDiaperPhotoPreview();

            document.getElementById('diaperModal').style.display = 'block';
        }

        function selectStool(stool) {
            selectedStoolValue = stool;

            // ÁßªÈô§ÊâÄÊúâÊåâÈàïÁöÑÈÅ∏‰∏≠ÁãÄÊÖã
            const allStoolBtns = document.querySelectorAll('.stool-btn');
            allStoolBtns.forEach(btn => {
                btn.classList.remove('selected');
            });

            // Ê∑ªÂä†ÈÅ∏‰∏≠ÁãÄÊÖãÂà∞Ë¢´ÈªûÊìäÁöÑÊåâÈàï
            const selectedBtn = document.getElementById(`stoolBtn-${stool}`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
            }
        }

        function handleDiaperPhotoUpload(event) {
            const files = event.target.files;
            if (files && files.length > 0) {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        diaperPhotos.push(e.target.result);
                        updateDiaperPhotoPreview();
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        function updateDiaperPhotoPreview() {
            const preview = document.getElementById('diaperPhotoPreview');
            preview.innerHTML = '';

            diaperPhotos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.style.position = 'relative';
                photoItem.style.aspectRatio = '1';
                photoItem.style.overflow = 'hidden';
                photoItem.style.borderRadius = '10px';
                photoItem.style.border = '2px solid #e0e0e0';
                photoItem.innerHTML = `
                    <img src="${photo}" alt="ÁÖßÁâá" style="width: 100%; height: 100%; object-fit: cover; cursor: pointer;" onclick="window.open('${photo}', '_blank');" />
                    <button type="button" onclick="removeDiaperPhotoByIndex(${index})" style="position: absolute; top: 5px; right: 5px; background: rgba(255, 0, 0, 0.7); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-weight: bold; font-size: 16px; line-height: 1;">√ó</button>
                `;
                preview.appendChild(photoItem);
            });
        }

        function removeDiaperPhotoByIndex(index) {
            diaperPhotos.splice(index, 1);
            updateDiaperPhotoPreview();
        }

        function removeDiaperPhoto() {
            document.getElementById('diaperPhotoInput').value = '';
            diaperPhotos = [];
            updateDiaperPhotoPreview();
        }

        function closeDiaperModal() {
            document.getElementById('diaperModal').style.display = 'none';
            selectedStoolValue = '';
            editingDiaperIndex = -1;
            removeDiaperPhoto(); // Ê∏ÖÈô§ÁÖßÁâáÈ†êË¶Ω
        }

        function diaperRecordComplete() {
            if (!selectedStoolValue) {
                alert('Ë´ãÈÅ∏Êìá‰æø‰æøÁãÄÊ≥Å');
                return;
            }

            // ÂæûËº∏ÂÖ•Ê¨Ñ‰ΩçÂèñÂæóÊôÇÈñìÔºåÂ¶ÇÊûúÊ≤íÊúâÂâá‰ΩøÁî®Áï∂ÂâçÊôÇÈñì
            const timeInput = document.getElementById('diaperTimeInput').value;
            let time;
            if (timeInput) {
                // Â∞á HH:MM Ê†ºÂºèËΩâÊèõÁÇ∫ HH:MM È°ØÁ§∫Ê†ºÂºè
                const [hours, minutes] = timeInput.split(':');
                time = `${hours}:${minutes}`;
            } else {
                time = new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            }

            if (isAllDiaperMode) {
                // ÂÖ®Áè≠Ê®°ÂºèÔºöÂÉÖÁ§∫ÊÑè‰ªãÈù¢
                closeDiaperModal();
                alert(`ÂÖ®Áè≠ÊèõÂ∞øÂ∏ÉË®òÈåÑÔºàÁ§∫ÊÑèÔºâÔºöÊôÇÈñì ${time}Ôºå‰æø‰æøÁãÄÊ≥ÅÔºö${selectedStoolValue}`);
            } else {
                // ÂÄã‰∫∫Ê®°ÂºèÔºöÁÇ∫ÂñÆ‰∏ÄÂ≠∏ÁîüË®òÈåÑ
                if (currentDiaperStudentId) {
                    // Áç≤ÂèñÁÖßÁâáÈô£Âàó
                    const photos = diaperPhotos.length > 0 ? [...diaperPhotos] : [];

                    if (editingDiaperIndex >= 0) {
                        // Á∑®ËºØÊ®°ÂºèÔºöÊõ¥Êñ∞ÁèæÊúâË®òÈåÑ
                        students[currentDiaperStudentId].diaper[editingDiaperIndex] = {
                            time: time,
                            description: '',
                            stool: selectedStoolValue,
                            photos: photos.length > 0 ? photos : null,
                            // ÂÖºÂÆπËàäÊ†ºÂºèÔºö‰øùÁïôÁ¨¨‰∏ÄÂºµÁÖßÁâá‰ΩúÁÇ∫ photo
                            photo: photos.length > 0 ? photos[0] : null
                        };
                    } else {
                        // Êñ∞Â¢ûÊ®°ÂºèÔºöÊ∑ªÂä†Êñ∞Ë®òÈåÑ
                        students[currentDiaperStudentId].diaper.push({
                            time: time,
                            description: '',
                            stool: selectedStoolValue,
                            photos: photos.length > 0 ? photos : null,
                            // ÂÖºÂÆπËàäÊ†ºÂºèÔºö‰øùÁïôÁ¨¨‰∏ÄÂºµÁÖßÁâá‰ΩúÁÇ∫ photo
                            photo: photos.length > 0 ? photos[0] : null
                        });
                    }
                    closeDiaperModal();
                    openModal(currentDiaperStudentId); // ÈáçÊñ∞ËºâÂÖ•modalÈ°ØÁ§∫Êõ¥Êñ∞ÂæåÁöÑË®òÈåÑ
                }
            }
        }

        // ÈªûÊìämodalÂ§ñÈÉ®ÈóúÈñâ
        window.onclick = function (event) {
            const modal = document.getElementById('studentModal');
            const calculatorModal = document.getElementById('calculatorModal');
            const diaperModal = document.getElementById('diaperModal');
            const classSelectModal = document.getElementById('classSelectModal');
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === calculatorModal) {
                closeCalculator();
            }
            if (event.target === diaperModal) {
                closeDiaperModal();
            }
            if (event.target === classSelectModal) {
                closeClassSelectModal();
            }
        }

        // ESCÈçµÈóúÈñâmodalÂíåË®àÁÆóÂô®
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                const calculatorModal = document.getElementById('calculatorModal');
                const studentModal = document.getElementById('studentModal');
                const diaperModal = document.getElementById('diaperModal');
                const classSelectModal = document.getElementById('classSelectModal');
                if (classSelectModal.style.display === 'block') {
                    closeClassSelectModal();
                } else if (diaperModal.style.display === 'block') {
                    closeDiaperModal();
                } else if (calculatorModal.style.display === 'block') {
                    closeCalculator();
                } else if (studentModal.style.display === 'block') {
                    closeModal();
                }
            }
        });

        // ÂÖ®Áè≠È§µÂ•∂ÂäüËÉΩÔºàÂÉÖÁ§∫ÊÑè‰ªãÈù¢Ôºâ
        function recordAllFeeding() {
            // ÊâìÈñãË®àÁÆóÂô®ËÆìÁî®Êà∂Ëº∏ÂÖ•ÊØ´ÂçáÊï∏ÔºàÂÉÖÁ§∫ÊÑèÔºâ
            openCalculatorForAllStudents();
        }

        // ÂÖ®Áè≠ÊèõÂ∞øÂ∏ÉÂäüËÉΩÔºàÂÉÖÁ§∫ÊÑè‰ªãÈù¢Ôºâ
        function recordAllDiaper() {
            // ÊâìÈñãÊèõÂ∞øÂ∏ÉË®òÈåÑ‰ªãÈù¢ÔºàÂÉÖÁ§∫ÊÑèÔºâ
            openDiaperModalForAllStudents();
        }

        // Êõ¥Êñ∞‰ªäÊó•È§µËó•Áµ±Ë®àÔºàÁ§∫ÊÑèÔºâ
        function updateMedicationSummary() {
            const summaryElement = document.getElementById('medicationSummary');
            if (summaryElement) {
                summaryElement.textContent = `‰ªäÊó•È§µËó•Ôºö2/3`;
            }
        }

        // È†ÅÈù¢ËºâÂÖ•ÊôÇÊõ¥Êñ∞Áµ±Ë®à
        updateMedicationSummary();

        // Áè≠Á¥öÈÅ∏ÊìáÂäüËÉΩ
        function openClassSelectModal() {
            document.getElementById('classSelectModal').style.display = 'block';
        }

        function closeClassSelectModal() {
            document.getElementById('classSelectModal').style.display = 'none';
        }

        function selectClass(className) {
            // Êõ¥Êñ∞ÊåâÈàïÊñáÂ≠ó
            const classBtn = document.querySelector('.header-class-btn');
            if (classBtn) {
                classBtn.textContent = className;
            }

            // Êõ¥Êñ∞Áï∂ÂâçÈÅ∏‰∏≠ÁöÑÁè≠Á¥öÊ®£Âºè
            const classItems = document.querySelectorAll('.class-item');
            classItems.forEach(item => {
                if (item.textContent === className) {
                    item.classList.add('current');
                } else {
                    item.classList.remove('current');
                }
            });

            // ÈóúÈñâ modal
            closeClassSelectModal();
        }

    </script>
</body>

</html>